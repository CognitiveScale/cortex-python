
mutation CreateProfileSchema($input: ProfileSchemaInput!) {
  createProfileSchema(input: $input) {
    name
  }
}

mutation UpdateProfileSchema($input: ProfileSchemaInput!) {
  updateProfileSchema(input: $input) {
    name
  }
}

mutation BuildProfile($project: String!, $profileSchema: String!) {
  buildProfile(project: $project, profileSchema: $profileSchema) {
    jobId
  }
}

mutation DeleteProfileSchema($input: DeleteProfileSchemaInput!) {
  deleteProfileSchema(input: $input)
}

query ProfileSchemaByName($project: String!, $name: String!) {
  profileSchemaByName(project: $project, name: $name) {
    primarySource {
      name
      attributes
      name
      profileGroup
    }
    joins {
      name
      attributes
      profileGroup
    }
    customAttributes {
      name
      expression
      window
    }
    bucketAttributes {
      name
      buckets {
        name
        filter
      }
    }
  }
}

query ProfileSchemaChangeLog(
  $project: String!
  $profileSchema: String!
  $limit: Int
) {
  profileHistory(
    project: $project
    profileSchema: $profileSchema
    limit: $limit
  ) {
    commitInfo {
      operation
      timestamp
      version
      userId
    }
    project
  }
}

query ProfileFeatures($schema: String!, $project: String!) {
  profileFeatures(project: $project, profileSchema: $schema) {
    featureName
    featureType
    dataType
    uniqueCount
    profileGroup
  }
}

query ProfileSchemaList($project: String!) {
  profileSchemas(project: $project) {
    name
    project {
      name
    }
    names {
      title
    }
    joins {
      name
    }
    primarySource {
      attributes
      name
    }
  }
}

query ProfileSchemaSummary($project: String!, $name: String!) {
  profileSchemaByName(project: $project, name: $name) {
    name
    title
    names {
      title
    }
    description
    primarySource {
      attributes
      name
      profileGroup
      profileKey
      timestamp {
        auto
        field
        fixed {
          format
          value
        }
        format
      }
    }
    joins {
      attributes
      join {
        joinSourceColumn
        primarySourceColumn
      }
      name
      profileGroup
      timestamp {
        auto
        field
        fixed {
          format
          value
        }
        format
      }
    }
    bucketAttributes {
      name
      profileGroup
      source {
        name
      }
      buckets {
        filter
        name
      }
    }
    customAttributes {
      expression
      name
      profileGroup
      source {
        name
      }
      window
    }
  }
}

query ProfileGroupCount($project: String!, $schema: String!, $filter: String, $groupBy: [String!]!, $limit: Int) {
  profileGroupCount(project: $project, profileSchema: $schema, filter: $filter, groupBy: $groupBy, limit: $limit) {
    key
    count
  }
}

query ProfileJobList($project: String!) {
  jobs(project: $project) {
    jobId
    isActive
    isCancelled
    isComplete
  }
}
